<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Asset EOL Dashboard v2.0</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        #error-box { display: none; }
    </style>

    <!-- 3. Libraries (Switched to CDNJS for React - Faster/More Reliable) -->
    <!-- React & ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop-Types (Dependency for Recharts) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    
    <!-- Recharts (Keep UNPKG or use JSDelivr if preferred) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js"></script>

    <!-- 4. Babel Standalone -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    
    <!-- Error Display -->
    <div id="error-box" class="fixed inset-0 bg-white z-50 flex items-center justify-center p-4">
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-lg w-full shadow-lg">
            <h2 class="text-red-700 font-bold text-xl mb-2">เกิดข้อผิดพลาด (System Errorna)</h2>
            <div class="bg-white p-3 rounded border border-red-100 mb-4">
                <p id="error-message" class="text-red-600 font-mono text-sm break-words"></p>
            </div>
            <div class="text-sm text-slate-600 space-y-2">
                <p class="font-semibold">วิธีแก้ไขเบื้องต้น:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>กด <b>Ctrl + F5</b> เพื่อล้าง Cache (สำคัญมาก)</li>
                    <li>ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต</li>
                    <li>รอสักครู่แล้วลองใหม่ (CDN อาจจะช้าในบางครั้ง)</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="root" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-slate-500">กำลังโหลด Dashboard v2.0...</p>
        </div>
    </div>

    <script>
        // Global Error Handler
        window.onerror = function(msg, url, line, col, error) {
            document.getElementById('error-box').style.display = 'flex';
            document.getElementById('error-message').textContent = msg + " (Line: " + line + ")";
            document.getElementById('root').style.display = 'none';
            return false;
        };
    </script>

    <!-- 5. Application Code -->
    <script type="text/babel">
        try {
            // --- Check Libraries Individually ---
            if (!window.React) throw new Error("React library failed to load.");
            if (!window.ReactDOM) throw new Error("ReactDOM library failed to load.");
            if (!window.Recharts) throw new Error("Recharts library failed to load. (Prop-types might be missing)");

            const { useState, useMemo, useEffect } = React;
            const { createRoot } = ReactDOM;
            const { 
                PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip: RechartsTooltip, Legend, ResponsiveContainer 
            } = window.Recharts;

            // --- Inline Icons (SVG) ---
            const Icons = {
                LayoutDashboard: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
                Upload: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
                AlertTriangle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
                Clock: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
                Server: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>,
                Layers: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>,
                Search: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
                Filter: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
                Trash2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
                FileSpreadsheet: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M8 13h2"/><path d="M14 13h2"/><path d="M8 17h2"/><path d="M14 17h2"/></svg>,
                HardDrive: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="22" x2="2" y1="12" y2="12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/><line x1="6" x2="6.01" y1="16" y2="16"/><line x1="10" x2="10.01" y1="16" y2="16"/></svg>,
                Box: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
                FileDown: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M12 18v-6"/><path d="m9 15 3 3 3-3"/></svg>
            };

            // --- Utility Functions ---

            const parseDate = (dateStr) => {
                if (!dateStr || dateStr === 'Not Announced' || dateStr.trim() === '') return null;
                const date = new Date(dateStr);
                return isNaN(date.getTime()) ? null : date;
            };

            const getStatus = (date) => {
                if (!date) return 'Unknown';
                const today = new Date();
                const diffTime = date - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays < 0) return 'Expired';
                if (diffDays <= 180) return 'Critical'; 
                if (diffDays <= 365) return 'Warning';  
                return 'Good';
            };

            const STATUS_COLORS = {
                Expired: '#EF4444', 
                Critical: '#F97316', 
                Warning: '#EAB308', 
                Good: '#22C55E',    
                Unknown: '#94A3B8'  
            };

            const STATUS_LABELS = {
                Expired: 'Expired',
                Critical: 'Critical (< 6mo)',
                Warning: 'Warning (< 1yr)',
                Good: 'Good',
                Unknown: 'Unknown'
            };

            // Template CSV Content
            const TEMPLATE_HEADERS = `ProjectCode,Project Name,Vendor,Device Type,Product Type,Hostname,Part Number,SerialNumber,Version,Major Version,HW EOL Date,HW LDoS,SW EOL Date,SW LDoS`;

            // CSV Parser
            const parseCSV = (text) => {
                const rows = [];
                let currentRow = [];
                let currentCell = '';
                let insideQuotes = false;
                const normalizedText = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

                for (let i = 0; i < normalizedText.length; i++) {
                    const char = normalizedText[i];
                    const nextChar = normalizedText[i + 1];
                    if (char === '"') {
                        if (insideQuotes && nextChar === '"') {
                            currentCell += '"'; i++;
                        } else { insideQuotes = !insideQuotes; }
                    } else if (char === ',' && !insideQuotes) {
                        currentRow.push(currentCell.trim()); currentCell = '';
                    } else if (char === '\n' && !insideQuotes) {
                        currentRow.push(currentCell.trim());
                        if (currentRow.length > 0 && (currentRow.length > 1 || currentRow[0] !== '')) {
                            rows.push(currentRow);
                        }
                        currentRow = []; currentCell = '';
                    } else { currentCell += char; }
                }
                if (currentCell || currentRow.length > 0) {
                    currentRow.push(currentCell.trim());
                    if (currentRow.length > 0 && (currentRow.length > 1 || currentRow[0] !== '')) {
                        rows.push(currentRow);
                    }
                }
                if (rows.length === 0) return [];
                const headers = rows[0].map(h => h.replace(/^"|"$/g, '').trim());
                return rows.slice(1).map(rowValues => {
                    const entry = {};
                    headers.forEach((header, index) => { entry[header] = rowValues[index] || ''; });
                    return entry;
                });
            };

            // --- Components ---

            function KPICard({ title, value, icon: Icon, color, subValue }) {
                return (
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-start justify-between hover:shadow-md transition-shadow">
                        <div>
                            <p className="text-sm font-medium text-slate-500 mb-1">{title}</p>
                            <h2 className="text-2xl font-bold text-slate-800">{value}</h2>
                            {subValue && <p className="text-sm text-slate-400 mt-1">{subValue} of Total</p>}
                        </div>
                        <div className={`p-3 rounded-lg ${color} bg-opacity-10`}>
                            <Icon className={`w-6 h-6 ${color.replace('bg-', 'text-')}`} />
                        </div>
                    </div>
                );
            }

            function StatusBadge({ status, type }) {
                const styles = {
                    Expired: 'bg-red-100 text-red-700 border-red-200',
                    Critical: 'bg-orange-100 text-orange-700 border-orange-200',
                    Warning: 'bg-yellow-100 text-yellow-700 border-yellow-200',
                    Good: 'bg-green-100 text-green-700 border-green-200',
                    Unknown: 'bg-slate-100 text-slate-600 border-slate-200'
                };
                return (
                    <span className={`inline-flex items-center px-2 py-0.5 rounded text-sm font-medium border ${styles[status] || styles.Unknown}`}>
                        {type}: {STATUS_LABELS[status]}
                    </span>
                );
            }

            // --- Main App Component ---

            function EOLDashboard() {
                const [rawData, setRawData] = useState([]);
                const [filteredData, setFilteredData] = useState([]);
                const [loading, setLoading] = useState(false);
                
                // Filters
                const [selectedVendor, setSelectedVendor] = useState('All');
                const [selectedProductType, setSelectedProductType] = useState('All');
                const [selectedHwStatus, setSelectedHwStatus] = useState('All');
                const [selectedSwStatus, setSelectedSwStatus] = useState('All');
                const [searchQuery, setSearchQuery] = useState('');

                // Process Data
                const processData = (csvData) => {
                    return csvData.map(item => {
                        const hwDate = parseDate(item['HW EOL Date']);
                        const swDate = parseDate(item['SW EOL Date']);
                        return {
                            ...item,
                            hwDateObj: hwDate,
                            swDateObj: swDate,
                            hwStatus: getStatus(hwDate),
                            swStatus: getStatus(swDate),
                            id: item.SerialNumber || Math.random().toString(36).substr(2, 9)
                        };
                    });
                };

                // Filter Logic
                useEffect(() => {
                    let result = rawData;
                    if (selectedVendor !== 'All') result = result.filter(item => item.Vendor === selectedVendor);
                    if (selectedProductType !== 'All') result = result.filter(item => item['Product Type'] === selectedProductType);
                    if (selectedHwStatus !== 'All') result = result.filter(item => item.hwStatus === selectedHwStatus);
                    if (selectedSwStatus !== 'All') result = result.filter(item => item.swStatus === selectedSwStatus);
                    if (searchQuery) {
                        const q = searchQuery.toLowerCase();
                        result = result.filter(item => 
                            (item.Hostname && item.Hostname.toLowerCase().includes(q)) ||
                            (item.SerialNumber && item.SerialNumber.toLowerCase().includes(q)) ||
                            (item['Part Number'] && item['Part Number'].toLowerCase().includes(q))
                        );
                    }
                    setFilteredData(result);
                }, [rawData, selectedVendor, selectedProductType, selectedHwStatus, selectedSwStatus, searchQuery]);

                // Handlers
                const handleFileUpload = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    setLoading(true);
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const text = e.target.result;
                        const data = parseCSV(text);
                        const processed = processData(data);
                        setRawData(processed);
                        setLoading(false);
                    };
                    reader.readAsText(file);
                };

                const handleDownloadTemplate = () => {
                    const blob = new Blob([TEMPLATE_HEADERS], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'eol_template.csv';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                };

                const handleClearData = () => {
                    setRawData([]); setFilteredData([]);
                    setSelectedVendor('All'); setSelectedProductType('All');
                    setSelectedHwStatus('All'); setSelectedSwStatus('All');
                    setSearchQuery('');
                };

                // Statistics
                const stats = useMemo(() => {
                    const total = filteredData.length;
                    const hwExpired = filteredData.filter(d => d.hwStatus === 'Expired').length;
                    const swExpired = filteredData.filter(d => d.swStatus === 'Expired').length;
                    const hwCritical = filteredData.filter(d => d.hwStatus === 'Critical').length;
                    const swCritical = filteredData.filter(d => d.swStatus === 'Critical').length;
                    return { total, hwExpired, swExpired, hwCritical, swCritical };
                }, [filteredData]);

                const yearData = useMemo(() => {
                    const years = {};
                    filteredData.forEach(d => {
                        if (d.hwDateObj) {
                            const y = d.hwDateObj.getFullYear();
                            if (!years[y]) years[y] = { name: y, HW: 0, SW: 0 };
                            years[y].HW += 1;
                        }
                        if (d.swDateObj) {
                            const y = d.swDateObj.getFullYear();
                            if (!years[y]) years[y] = { name: y, HW: 0, SW: 0 };
                            years[y].SW += 1;
                        }
                    });
                    return Object.values(years).sort((a, b) => a.name - b.name);
                }, [filteredData]);

                const hwStatusDist = useMemo(() => {
                    const counts = { Expired: 0, Critical: 0, Warning: 0, Good: 0, Unknown: 0 };
                    filteredData.forEach(d => counts[d.hwStatus]++);
                    return Object.keys(counts).map(key => ({ name: STATUS_LABELS[key], value: counts[key], key }));
                }, [filteredData]);

                const swStatusDist = useMemo(() => {
                    const counts = { Expired: 0, Critical: 0, Warning: 0, Good: 0, Unknown: 0 };
                    filteredData.forEach(d => counts[d.swStatus]++);
                    return Object.keys(counts).map(key => ({ name: STATUS_LABELS[key], value: counts[key], key }));
                }, [filteredData]);

                const vendorDist = useMemo(() => {
                    const counts = {};
                    filteredData.forEach(d => counts[d.Vendor] = (counts[d.Vendor] || 0) + 1);
                    return Object.keys(counts).map(key => ({ name: key, value: counts[key] })).sort((a, b) => b.value - a.value).slice(0, 10);
                }, [filteredData]);

                const typeDist = useMemo(() => {
                    const counts = {};
                    filteredData.forEach(d => counts[d['Product Type']] = (counts[d['Product Type']] || 0) + 1);
                    return Object.keys(counts).map(key => ({ name: key, value: counts[key] })).sort((a, b) => b.value - a.value).slice(0, 10);
                }, [filteredData]);

                const vendors = ['All', ...new Set(rawData.map(d => d.Vendor).filter(Boolean))];
                const productTypes = ['All', ...new Set(rawData.map(d => d['Product Type']).filter(Boolean))];
                const statusOptions = ['All', 'Expired', 'Critical', 'Warning', 'Good', 'Unknown'];

                return (
                    <div className="min-h-screen">
                        {/* Header */}
                        <div className="bg-white shadow-sm sticky top-0 z-20">
                            <div className="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-2">
                                    <Icons.LayoutDashboard className="text-blue-600 w-8 h-8" />
                                    <div>
                                        <h1 className="text-xl font-bold text-slate-800">IT Asset EOL Dashboard <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full ml-2">(v2.0 Loaded ✅)</span></h1>
                                        <p className="text-sm text-slate-500">Hardware & Software Lifecycle Monitor</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <button onClick={handleDownloadTemplate} className="flex items-center gap-2 px-3 py-2 text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-blue-600 transition shadow-sm text-sm font-medium">
                                        <Icons.FileDown className="w-4 h-4" /> <span className="hidden sm:inline">Template</span>
                                    </button>
                                    <label className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg cursor-pointer hover:bg-blue-700 transition shadow-sm text-sm font-medium">
                                        <Icons.Upload className="w-4 h-4" /> <span>Import CSV</span>
                                        <input type="file" accept=".csv" onChange={handleFileUpload} className="hidden" />
                                    </label>
                                    {rawData.length > 0 && (
                                        <button onClick={handleClearData} className="p-2 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-full" title="Clear Data">
                                            <Icons.Trash2 className="w-5 h-5" />
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
                            {rawData.length === 0 ? (
                                <div className="flex flex-col items-center justify-center py-20 bg-white rounded-xl border-2 border-dashed border-slate-200">
                                    <div className="bg-blue-50 p-6 rounded-full mb-4"><Icons.FileSpreadsheet className="w-16 h-16 text-blue-500" /></div>
                                    <h2 className="text-2xl font-bold text-slate-700 mb-2">No Data Available</h2>
                                    <p className="text-slate-500 mb-6 text-center max-w-md">Please upload your hardware/software EOL CSV file to generate the dashboard.</p>
                                    <div className="flex gap-4">
                                        <button onClick={handleDownloadTemplate} className="flex items-center gap-2 px-6 py-3 bg-white text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-blue-600 transition shadow-sm text-base font-medium">
                                            <Icons.FileDown className="w-5 h-5" /> <span>Download Template</span>
                                        </button>
                                        <label className="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg cursor-pointer hover:bg-blue-700 transition shadow-md text-base font-medium">
                                            <Icons.Upload className="w-5 h-5" /> <span>Upload CSV File</span>
                                            <input type="file" accept=".csv" onChange={handleFileUpload} className="hidden" />
                                        </label>
                                    </div>
                                    <p className="mt-4 text-xs text-slate-400">Supported Format: ProjectCode, Vendor, Hostname, HW EOL Date, SW EOL Date, etc.</p>
                                </div>
                            ) : (
                                <>
                                    {/* KPIs */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <KPICard title="Total Devices" value={stats.total} icon={Icons.Server} color="bg-blue-500" />
                                        <KPICard title="HW Expired" value={stats.hwExpired} icon={Icons.AlertTriangle} color="bg-red-500" subValue={`${((stats.hwExpired/stats.total || 0)*100).toFixed(1)}%`} />
                                        <KPICard title="HW Critical (< 6mo)" value={stats.hwCritical} icon={Icons.Clock} color="bg-orange-500" />
                                        <KPICard title="SW Critical (< 6mo)" value={stats.swCritical} icon={Icons.Layers} color="bg-yellow-500" />
                                    </div>

                                    {/* Filters */}
                                    <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
                                        <div className="flex flex-wrap gap-4 w-full lg:w-auto">
                                            {[
                                                { label: 'Vendor', val: selectedVendor, set: setSelectedVendor, opts: vendors, icon: Icons.Filter },
                                                { label: 'Product Type', val: selectedProductType, set: setSelectedProductType, opts: productTypes, icon: Icons.Box },
                                                { label: 'Hardware Status', val: selectedHwStatus, set: setSelectedHwStatus, opts: statusOptions, icon: Icons.HardDrive, isStatus: true },
                                                { label: 'Software Status', val: selectedSwStatus, set: setSelectedSwStatus, opts: statusOptions, icon: Icons.Layers, isStatus: true }
                                            ].map((f, i) => (
                                                <div key={i} className="flex flex-col gap-1 w-[180px]">
                                                    <span className="text-xs font-semibold text-slate-500 ml-1">{f.label}</span>
                                                    <div className="flex items-center gap-2 bg-slate-50 border border-slate-200 rounded-md px-2">
                                                        <f.icon className="w-4 h-4 text-slate-400 shrink-0" />
                                                        <select className="w-full bg-transparent py-2 text-sm focus:outline-none" value={f.val} onChange={e => f.set(e.target.value)}>
                                                            {f.isStatus ? (
                                                                <>
                                                                    <option value="All">All Statuses</option>
                                                                    {f.opts.slice(1).map(s => <option key={s} value={s}>{STATUS_LABELS[s]}</option>)}
                                                                </>
                                                            ) : (
                                                                f.opts.map(v => <option key={v} value={v}>{v === 'All' ? `All ${f.label}s` : v}</option>)
                                                            )}
                                                        </select>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="relative w-full lg:w-72 mt-4 lg:mt-0">
                                            <Icons.Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4" />
                                            <input type="text" placeholder="Search Hostname, Serial..." className="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} />
                                        </div>
                                    </div>

                                    {/* Charts */}
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 lg:col-span-2">
                                                <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2"><Icons.Clock className="w-5 h-5 text-blue-500" /> Annual EOL Trend</h3>
                                                <div className="h-72">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <BarChart data={yearData} margin={{ top: 20, right: 30, left: 0, bottom: 5 }}>
                                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                                            <XAxis dataKey="name" />
                                                            <YAxis />
                                                            <RechartsTooltip contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }} />
                                                            <Legend />
                                                            <Bar dataKey="HW" name="Hardware EOL" fill="#3B82F6" radius={[4, 4, 0, 0]} />
                                                            <Bar dataKey="SW" name="Software EOL" fill="#8B5CF6" radius={[4, 4, 0, 0]} />
                                                        </BarChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </div>
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                                <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2"><Icons.Filter className="w-5 h-5 text-purple-500" /> Vendor Distribution</h3>
                                                <div className="h-72">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <BarChart layout="vertical" data={vendorDist} margin={{ top: 5, right: 30, left: 40, bottom: 5 }}>
                                                            <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                                            <XAxis type="number" hide />
                                                            <YAxis type="category" dataKey="name" width={100} tick={{fontSize: 12}} />
                                                            <RechartsTooltip />
                                                            <Bar dataKey="value" name="Devices" fill="#6366F1" radius={[0, 4, 4, 0]} />
                                                        </BarChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                                <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2"><Icons.AlertTriangle className="w-5 h-5 text-orange-500" /> Hardware EOL Status</h3>
                                                <div className="h-64">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <PieChart>
                                                            <Pie data={hwStatusDist} cx="50%" cy="50%" innerRadius={50} outerRadius={80} paddingAngle={5} dataKey="value">
                                                                {hwStatusDist.map((entry, index) => <Cell key={`cell-${index}`} fill={STATUS_COLORS[entry.key]} />)}
                                                            </Pie>
                                                            <RechartsTooltip />
                                                            <Legend verticalAlign="bottom" height={36}/>
                                                        </PieChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </div>
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                                <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2"><Icons.AlertTriangle className="w-5 h-5 text-yellow-500" /> Software EOL Status</h3>
                                                <div className="h-64">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <PieChart>
                                                            <Pie data={swStatusDist} cx="50%" cy="50%" innerRadius={50} outerRadius={80} paddingAngle={5} dataKey="value">
                                                                {swStatusDist.map((entry, index) => <Cell key={`cell-${index}`} fill={STATUS_COLORS[entry.key]} />)}
                                                            </Pie>
                                                            <RechartsTooltip />
                                                            <Legend verticalAlign="bottom" height={36}/>
                                                        </PieChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </div>
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                                <h3 className="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2"><Icons.Box className="w-5 h-5 text-green-500" /> Product Types</h3>
                                                <div className="h-64">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <BarChart data={typeDist} layout="vertical" margin={{ top: 5, right: 30, left: 40, bottom: 5 }}>
                                                            <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                                            <XAxis type="number" hide />
                                                            <YAxis type="category" dataKey="name" width={100} tick={{fontSize: 12}} />
                                                            <RechartsTooltip />
                                                            <Bar dataKey="value" fill="#10B981" radius={[0, 4, 4, 0]} />
                                                        </BarChart>
                                                    </ResponsiveContainer>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Table */}
                                    <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                            <h3 className="font-semibold text-slate-800">Device List</h3>
                                            <span className="text-sm text-slate-500">{filteredData.length} Items</span>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-slate-50 text-slate-500 font-medium">
                                                    <tr>
                                                        <th className="px-6 py-3">Hostname</th>
                                                        <th className="px-6 py-3">Vendor / Model</th>
                                                        <th className="px-6 py-3">Part Number</th>
                                                        <th className="px-6 py-3">Serial Number</th>
                                                        <th className="px-6 py-3">SW Version</th>
                                                        <th className="px-6 py-3">HW EOL</th>
                                                        <th className="px-6 py-3">SW EOL</th>
                                                        <th className="px-6 py-3">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {filteredData.slice(0, 50).map((item) => (
                                                        <tr key={item.id} className="hover:bg-slate-50 transition-colors">
                                                            <td className="px-6 py-3 font-medium text-slate-700">{item.Hostname}</td>
                                                            <td className="px-6 py-3"><div className="text-slate-800">{item.Vendor}</div><div className="text-sm text-slate-500">{item['Product Type']}</div></td>
                                                            <td className="px-6 py-3 font-mono text-slate-600">{item['Part Number']}</td>
                                                            <td className="px-6 py-3 font-mono text-slate-500">{item.SerialNumber}</td>
                                                            <td className="px-6 py-3 font-mono text-slate-600">{item['Version']}</td>
                                                            <td className="px-6 py-3">
                                                                <div className="flex items-center gap-2">
                                                                    {item['HW EOL Date']}
                                                                    {item.hwStatus === 'Critical' && <Icons.AlertTriangle className="w-3 h-3 text-orange-500" />}
                                                                    {item.hwStatus === 'Expired' && <Icons.AlertTriangle className="w-3 h-3 text-red-500" />}
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-3">{item['SW EOL Date']}</td>
                                                            <td className="px-6 py-3">
                                                                <div className="flex flex-col gap-1">
                                                                    <StatusBadge status={item.hwStatus} type="HW" />
                                                                    <StatusBadge status={item.swStatus} type="SW" />
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                );
            }

            const root = createRoot(document.getElementById('root'));
            root.render(<EOLDashboard />);
        } catch (err) {
            console.error(err);
            document.getElementById('error-box').style.display = 'flex';
            document.getElementById('error-message').textContent = err.toString();
            document.getElementById('root').style.display = 'none';
        }
    </script>
</body>
</html>